# 実装計画: ダッシュボード（温度・湿度・4部屋対応）

**ブランチ**: `[002-dashboard-feature]` | **日付**: 2025-09-13 | **仕様書**: [/home/saki/github/specDrivenDevelopmentSample/specs/002-dashboard-feature/spec.md]  
**入力**: `/specs/002-dashboard-feature/spec.md` の機能仕様

## 実行フロー (/plan コマンド範囲)
```
1. 入力パスから仕様書を読み込む
2. 技術コンテキストを記入（NEEDS CLARIFICATION を抽出）
3. 憲法チェックセクションを評価
4. フェーズ0 → research.md を実行
5. フェーズ1 → contracts, data-model.md, quickstart.md, エージェント用テンプレートファイルを作成
6. 憲法チェックセクションを再評価
7. フェーズ2 → タスク生成アプローチを記述（tasks.mdは作成しない）
8. STOP - /tasks コマンドの準備完了
```

## サマリー
本機能は、ユーザーがブラウザ上でダッシュボード画面を開き、4部屋分の温度・湿度データを2軸グラフで確認できます。  
グラフはChartJSを利用し、部屋名はカスタマイズ可能です。  
データは5分毎に更新され、1か月分を5分単位で表示します（履歴表示機能は不要）。

## 技術コンテキスト
**言語/バージョン**: JavaScript (ES2021+), HTML5, CSS3  
**主な依存関係**: ChartJS  
**データ保存**: LocalStorage（1か月分の温度・湿度データ、部屋名設定）  
**テスト**: [NEEDS CLARIFICATION: テストフレームワーク（例：Jest, Mocha, なし）]  
**対象プラットフォーム**: ブラウザ（PC/スマホ）  
**プロジェクトタイプ**: web（フロントエンドのみ）  
**パフォーマンス目標**: 1秒以内ロード、グラフ描画は100ms以内  
**制約**: ChartJS利用、HTML5準拠  
**規模/スコープ**: 4部屋分の温度・湿度グラフ、部屋名カスタマイズ、1か月分データ（5分単位）

## 憲法チェック

**シンプルさ**:
- プロジェクト数: 1（フロントエンドのみ）
- ChartJS直接利用
- 単一データモデル（部屋、ダッシュボード、グラフデータ）
- 設計パターン回避

**アーキテクチャ**:
- 全機能をライブラリ化（ダッシュボードロジックはモジュール化）
- 使用ライブラリ一覧: ChartJS
- CLI per library: 該当なし
- ライブラリドキュメント: llms.txt形式予定 [NEEDS CLARIFICATION]

**テスト（必須）**:
- RED-GREEN-リファクタサイクル厳守 [NEEDS CLARIFICATION: テスト方針]
- Gitコミットはテスト→実装順（TDD推奨）
- 順序: コントラクト→統合→E2E→ユニット厳守
- 実際の依存関係使用（ChartJS, ブラウザAPI）
- 統合テスト: 新規ライブラリ、コントラクト変更、共有スキーマ
- 禁止: 実装先行、REDフェーズ省略

**可観測性**:
- 構造化ログ含む [NEEDS CLARIFICATION: ログ出力要否]
- フロントログ→バックエンド: 該当なし
- エラー文脈十分

**バージョニング**:
- バージョン番号付与: MAJOR.MINOR.BUILD（例：1.0.0）
- BUILDは変更ごとに増加
- 破壊的変更対応（互換性維持）

## プロジェクト構成

### ドキュメント（本機能）
```
specs/002-dashboard-feature/
├── plan.md
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
└── tasks.md
```

### ソースコード（リポジトリルート）
```
src/
├── models/
├── services/
├── components/
└── lib/
tests/
├── contract/
├── integration/
└── unit/
```

**構造方針**: フロントエンドのみ（src/、tests/）

## フェーズ0: アウトライン＆リサーチ
1. **技術コンテキストから不明点抽出**:
   - テストフレームワーク選定
   - ログ出力要否
   - llms.txtドキュメント要否

2. **リサーチエージェント生成・実行**:
   ```
   タスク: "ChartJSで4部屋分の温度・湿度を2軸グラフで表示するベストプラクティスを調査"
   タスク: "LocalStorageで1か月分の5分単位データを安全に保存・取得する方法を調査"
   タスク: "部屋名カスタマイズUIのベストプラクティスを調査"
   タスク: "PC/スマホ対応のUI設計を調査"
   タスク: "テストフレームワーク（Jest, Mocha, なし）を調査"
   タスク: "ログ出力要否と方法を調査"
   ```

3. **research.md に調査結果を統合**:
   - 決定事項: [選択内容]
   - 根拠: [選択理由]
   - 他の選択肢: [比較検討内容]

**成果物**: research.md（全NEEDS CLARIFICATION解消済み）

## フェーズ1: 設計＆コントラクト
*前提: research.md 完了*

1. **仕様書からエンティティ抽出 → data-model.md**:
   - エンティティ名、フィールド、関係性
   - バリデーションルール（部屋名カスタマイズ、温度・湿度データ、5分単位、1か月分）
   - 状態遷移（部屋名変更、データ追加・更新）

2. **機能要件からAPIコントラクト生成**:
   - 該当なし（API不要、ローカル保存のみ）

3. **コントラクトテスト生成**:
   - 該当なし（API不要）

4. **ユーザーストーリーからテストシナリオ抽出**:
   - ダッシュボード表示・部屋名カスタマイズ・グラフ描画・データ保存・欠損表示

5. **エージェントファイルを随時更新**（O(1)操作）:
   - `/specify/scripts/bash/update-agent-context.sh copilot` を実行

**成果物**: data-model.md, quickstart.md, テスト（失敗状態）, エージェント用ファイル

## フェーズ2: タスク計画アプローチ
*このセクションは /tasks コマンドで実行。ここでは記述のみ*

**タスク生成方針**:
- `/templates/tasks-template.md` をベースにロード
- フェーズ1設計ドキュメント（data model, quickstart）からタスク生成
- 各エンティティ → モデル作成タスク [P]
- 各ユーザーストーリー → 統合テストタスク
- テスト合格のための実装タスク

**順序方針**:
- TDD順: テスト→実装
- 依存順: モデル→サービス→UI
- [P]は並列実行可能（独立ファイル）

**推定タスク数**: 20～30件（tasks.md）

**重要**: このフェーズは /tasks コマンドで実行。/plan では実行しない

## フェーズ3以降: 実装以降
*これ以降は /plan コマンドの範囲外*

**フェーズ3**: タスク実行（/tasks コマンドで tasks.md 作成）  
**フェーズ4**: 実装（tasks.md に従い憲法原則を守って実装）  
**フェーズ5**: 検証（テスト実行、quickstart.md 実行、パフォーマンス検証）

## 複雑性トラッキング
*憲法チェック違反がある場合のみ記入*

| 違反内容 | 必要理由 | 却下した簡易案 |
|----------|----------|----------------|
| なし     |          |                |

## 進捗トラッキング
*実行フローに応じて更新*

**フェーズ進捗**:
- [x] フェーズ0: リサーチ完了 (/plan コマンド)
- [x] フェーズ1: 設計完了 (/plan コマンド)
- [x] フェーズ2: タスク計画完了 (/plan コマンド・記述のみ)
- [ ] フェーズ3: タスク生成済み (/tasks コマンド)
- [ ] フェーズ4: 実装完了
- [ ] フェーズ5: 検証完了

**ゲート進捗**:
- [x] 初期憲法チェック: 合格
- [x] 設計後憲法チェック: 合格
- [ ] 全NEEDS CLARIFICATION解消済み
- [ ] 複雑性逸脱記録済み

---
*憲法 v2.1.1 に基づく - `/memory/constitution.md` を参照